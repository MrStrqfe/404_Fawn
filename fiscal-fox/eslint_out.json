[{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\content\\key-terms.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":9,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":9,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":103,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":103,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":113,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":113,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":117,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":11}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Key Term Highlighting ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nlet keyTermsEnabled = false;\r\nlet dictionaryCache = null;\r\nlet tooltipEl = null;\r\n\r\nasync function loadDictionary() {\r\n  if (dictionaryCache) return dictionaryCache;\r\n  const url = chrome.runtime.getURL('dictionary.json');\r\n  const resp = await fetch(url);\r\n  dictionaryCache = await resp.json();\r\n  return dictionaryCache;\r\n}\r\n\r\nfunction buildTermRegex(dict) {\r\n  // Sort longest first so multi-word terms match before their sub-terms\r\n  const terms = Object.keys(dict).sort((a, b) => b.length - a.length);\r\n  const escaped = terms.map(t => t.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'));\r\n  return new RegExp('\\\\b(' + escaped.join('|') + ')\\\\b', 'gi');\r\n}\r\n\r\nfunction getTooltip() {\r\n  if (!tooltipEl) {\r\n    tooltipEl = document.createElement('div');\r\n    tooltipEl.id = 'fiscal-fox-tooltip';\r\n    tooltipEl.style.cssText =\r\n      'position:fixed;z-index:2147483647;background:#21242d;color:#e0e0e0;' +\r\n      'border:1px solid #61dafb;border-radius:8px;padding:10px 14px;' +\r\n      'max-width:300px;font-size:13px;line-height:1.5;pointer-events:none;' +\r\n      'display:none;box-shadow:0 4px 16px rgba(0,0,0,0.6);font-family:sans-serif;';\r\n    document.body.appendChild(tooltipEl);\r\n  }\r\n  return tooltipEl;\r\n}\r\n\r\nconst SKIP_TAGS = new Set(['SCRIPT', 'STYLE', 'NOSCRIPT', 'TEXTAREA', 'INPUT', 'SELECT', 'CODE', 'PRE', 'HEAD']);\r\n\r\nfunction highlightInNode(node, dict, regex) {\r\n  if (node.nodeType === Node.ELEMENT_NODE) {\r\n    if (SKIP_TAGS.has(node.tagName)) return;\r\n    if (node.id === 'fiscal-fox-tooltip') return;\r\n    if (node.classList && node.classList.contains('fiscal-fox-term')) return;\r\n    Array.from(node.childNodes).forEach(child => highlightInNode(child, dict, regex));\r\n  } else if (node.nodeType === Node.TEXT_NODE) {\r\n    const text = node.textContent;\r\n    regex.lastIndex = 0;\r\n    if (!regex.test(text)) return;\r\n    regex.lastIndex = 0;\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    let lastIndex = 0, match;\r\n    while ((match = regex.exec(text)) !== null) {\r\n      if (match.index > lastIndex) {\r\n        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));\r\n      }\r\n      const matchedText = match[0];\r\n      const termKey = Object.keys(dict).find(k => k.toLowerCase() === matchedText.toLowerCase());\r\n      const span = document.createElement('span');\r\n      span.className = 'fiscal-fox-term';\r\n      span.textContent = matchedText;\r\n      span.style.cssText =\r\n        'background:rgba(97,218,251,0.15);border-bottom:1px dotted #61dafb;' +\r\n        'cursor:help;border-radius:2px;';\r\n      if (termKey) {\r\n        const definition = dict[termKey];\r\n        span.addEventListener('mouseenter', () => {\r\n          const tt = getTooltip();\r\n          tt.innerHTML = '<strong style=\"color:#61dafb\">' + termKey + '</strong><br>' + definition;\r\n          tt.style.display = 'block';\r\n          const r = span.getBoundingClientRect();\r\n          tt.style.left = Math.min(r.left, window.innerWidth - 320) + 'px';\r\n          tt.style.top = (r.bottom + 8) + 'px';\r\n        });\r\n        span.addEventListener('mouseleave', () => {\r\n          getTooltip().style.display = 'none';\r\n        });\r\n      }\r\n      fragment.appendChild(span);\r\n      lastIndex = match.index + matchedText.length;\r\n    }\r\n    if (lastIndex < text.length) {\r\n      fragment.appendChild(document.createTextNode(text.slice(lastIndex)));\r\n    }\r\n    node.parentNode.replaceChild(fragment, node);\r\n  }\r\n}\r\n\r\nasync function applyKeyTermHighlighting() {\r\n  if (!keyTermsEnabled) return;\r\n  const dict = await loadDictionary();\r\n  const regex = buildTermRegex(dict);\r\n  highlightInNode(document.body, dict, regex);\r\n}\r\n\r\nfunction removeKeyTermHighlighting() {\r\n  document.querySelectorAll('span.fiscal-fox-term').forEach(span => {\r\n    span.replaceWith(document.createTextNode(span.textContent));\r\n  });\r\n  if (tooltipEl) tooltipEl.style.display = 'none';\r\n}\r\n\r\n// ΓöÇΓöÇ Page load: read active profile key terms setting and apply ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.storage.sync.get(['profiles', 'activeProfile'], (data) => {\r\n  const activeProfile = data.activeProfile || 'Mom';\r\n  const profiles = data.profiles || {};\r\n  const pData = profiles[activeProfile] || {};\r\n\r\n  keyTermsEnabled = !!pData.keyTermsEnabled;\r\n  if (keyTermsEnabled) applyKeyTermHighlighting();\r\n});\r\n\r\n// ΓöÇΓöÇ Real-time updates from settings page ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.storage.onChanged.addListener((changes, area) => {\r\n  if (area !== 'sync') return;\r\n\r\n  if (changes.profiles || changes.activeProfile) {\r\n    chrome.storage.sync.get(['profiles', 'activeProfile'], (data) => {\r\n      const activeProfile = data.activeProfile || 'Mom';\r\n      const profiles = data.profiles || {};\r\n      const pData = profiles[activeProfile] || {};\r\n\r\n      const oldKeyTerms = keyTermsEnabled;\r\n      keyTermsEnabled = !!pData.keyTermsEnabled;\r\n\r\n      if (keyTermsEnabled !== oldKeyTerms) {\r\n        if (keyTermsEnabled) {\r\n          applyKeyTermHighlighting();\r\n        } else {\r\n          removeKeyTermHighlighting();\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\content\\night-mode.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token (149:5)","line":149,"column":5,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const hostname = window.location.hostname;\r\n\r\n// ΓöÇΓöÇ State ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nlet nightModeEnabled = false;\r\nlet colourBlindEnabled = false;\r\nlet colourBlindPreset = 'none';\r\nlet colourBlindR = 100, colourBlindG = 100, colourBlindB = 100;\r\nlet dyslexicReadingEnabled = false;\r\n\r\n// ΓöÇΓöÇ Matrix builder ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction buildMatrixValues(r, g, b, preset) {\r\n  // Monochromacy: fixed ITU-R BT.709 luminance-weighted greyscale\r\n  if (preset === 'monochromacy') {\r\n    return '0.2126 0.7152 0.0722 0 0  ' +\r\n      '0.2126 0.7152 0.0722 0 0  ' +\r\n      '0.2126 0.7152 0.0722 0 0  ' +\r\n      '0 0 0 1 0';\r\n  }\r\n  const rS = r / 100;\r\n  const gS = g / 100;\r\n  const bS = b / 100;\r\n  // Off-diagonal = redistribute clipped remainder equally to other channels\r\n  const rOff = Math.max(0, (1 - rS) / 2);\r\n  const gOff = Math.max(0, (1 - gS) / 2);\r\n  const bOff = Math.max(0, (1 - bS) / 2);\r\n  return `${rS} ${rOff} ${rOff} 0 0  ` +\r\n    `${gOff} ${gS} ${gOff} 0 0  ` +\r\n    `${bOff} ${bOff} ${bS} 0 0  ` +\r\n    `0 0 0 1 0`;\r\n}\r\n\r\n// ΓöÇΓöÇ Unified filter application ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction applyFilters() {\r\n  const svgId = 'fiscal-fox-cb-svg';\r\n  const styleId = 'fiscal-fox-active-filter';\r\n\r\n  // Manage the SVG colour matrix element\r\n  let svg = document.getElementById(svgId);\r\n  if (colourBlindEnabled) {\r\n    const matrixValues = buildMatrixValues(colourBlindR, colourBlindG, colourBlindB, colourBlindPreset);\r\n    if (!svg) {\r\n      svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      svg.id = svgId;\r\n      svg.setAttribute('style', 'position:absolute;width:0;height:0;overflow:hidden');\r\n      svg.setAttribute('aria-hidden', 'true');\r\n      svg.innerHTML =\r\n        '<defs><filter id=\"fiscal-fox-cb-filter\">' +\r\n        '<feColorMatrix type=\"matrix\" values=\"' + matrixValues + '\" />' +\r\n        '</filter></defs>';\r\n      document.body.appendChild(svg);\r\n    } else {\r\n      svg.querySelector('feColorMatrix').setAttribute('values', matrixValues);\r\n    }\r\n  } else {\r\n    if (svg) svg.remove();\r\n  }\r\n\r\n  // Build combined filter string (CB first so it operates on natural colours)\r\n  const parts = [];\r\n  if (colourBlindEnabled) parts.push('url(#fiscal-fox-cb-filter)');\r\n  if (nightModeEnabled) parts.push('invert(1) hue-rotate(180deg)');\r\n\r\n  // Manage the unified style element\r\n  let style = document.getElementById(styleId);\r\n  if (parts.length === 0) {\r\n    if (style) style.remove();\r\n    return;\r\n  }\r\n  if (!style) {\r\n    style = document.createElement('style');\r\n    style.id = styleId;\r\n    document.head.appendChild(style);\r\n  }\r\n\r\n  // Re-invert media only when night mode is active (colourblind filter should apply to images too)\r\n  const mediaRule = nightModeEnabled\r\n    ? 'filter: invert(1) hue-rotate(180deg);'\r\n    : 'filter: none;';\r\n\r\n  style.textContent =\r\n    'html { filter: ' + parts.join(' ') + '; }\\n' +\r\n    'img, video, iframe, canvas, picture { ' + mediaRule + ' }';\r\n}\r\n\r\n// ΓöÇΓöÇ Page load: read active profile and apply settings ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.storage.sync.get(['profiles', 'activeProfile', 'rememberPerSite', 'nightModeSites'], (data) => {\r\n  const activeProfile = data.activeProfile || 'Mom';\r\n  const profiles = data.profiles || {};\r\n  const pData = profiles[activeProfile] || {};\r\n\r\n  const perSite = data.rememberPerSite && data.nightModeSites && data.nightModeSites[hostname];\r\n  nightModeEnabled = !!(pData.globalNightMode || perSite);\r\n\r\n  colourBlindEnabled = !!pData.colourBlindEnabled;\r\n  colourBlindPreset = pData.colourBlindPreset || 'none';\r\n  colourBlindR = pData.colourBlindR ?? 100;\r\n  colourBlindG = pData.colourBlindG ?? 100;\r\n  colourBlindB = pData.colourBlindB ?? 100;\r\n\r\n  dyslexicReadingEnabled = !!pData.dyslexicReadingEnabled;\r\n\r\n  applyFilters();\r\n  applyDyslexicFont();\r\n});\r\n\r\n\r\n// ΓöÇΓöÇ Real-time updates from settings page ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.storage.onChanged.addListener((changes, area) => {\r\n  if (area !== 'sync') return;\r\n\r\n  // We only care if 'profiles' or 'activeProfile' changed\r\n  if (changes.profiles || changes.activeProfile) {\r\n    chrome.storage.sync.get(['profiles', 'activeProfile', 'rememberPerSite', 'nightModeSites'], (data) => {\r\n      const activeProfile = data.activeProfile || 'Mom';\r\n      const profiles = data.profiles || {};\r\n      const pData = profiles[activeProfile] || {};\r\n\r\n      const oldNightMode = nightModeEnabled;\r\n      const oldColourBlind = colourBlindEnabled;\r\n      const oldPreset = colourBlindPreset;\r\n      const oldR = colourBlindR, oldG = colourBlindG, oldB = colourBlindB;\r\n      const oldDyslexic = dyslexicReadingEnabled;\r\n\r\n      const perSite = data.rememberPerSite && data.nightModeSites && data.nightModeSites[hostname];\r\n      nightModeEnabled = !!(pData.globalNightMode || perSite);\r\n\r\n      colourBlindEnabled = !!pData.colourBlindEnabled;\r\n      colourBlindPreset = pData.colourBlindPreset || 'none';\r\n      colourBlindR = pData.colourBlindR ?? 100;\r\n      colourBlindG = pData.colourBlindG ?? 100;\r\n      colourBlindB = pData.colourBlindB ?? 100;\r\n\r\n      dyslexicReadingEnabled = !!pData.dyslexicReadingEnabled;\r\n\r\n      // Apply changes if any visual settings altered\r\n      if (\r\n        nightModeEnabled !== oldNightMode ||\r\n        colourBlindEnabled !== oldColourBlind ||\r\n        colourBlindPreset !== oldPreset ||\r\n        colourBlindR !== oldR || colourBlindG !== oldG || colourBlindB !== oldB\r\n      ) {\r\n        applyFilters();\r\n      }\r\n\r\n      if (keyTermsEnabled !== oldKeyTerms) {\r\n      if (dyslexicReadingEnabled !== oldDyslexic) {\r\n        applyDyslexicFont();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\n\r\n// ΓöÇΓöÇ Messages from popup ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {\r\n  if (msg.action === 'getState') {\r\n    sendResponse({ nightMode: nightModeEnabled });\r\n    return;\r\n  }\r\n\r\n  if (msg.action === 'toggleNightMode') {\r\n    nightModeEnabled = !nightModeEnabled;\r\n    applyFilters();\r\n\r\n    // The popup toggle needs to save back to the correct profile\r\n    chrome.storage.sync.get(['profiles', 'activeProfile', 'rememberPerSite', 'nightModeSites'], (data) => {\r\n      const activeProfile = data.activeProfile || 'Mom';\r\n      const profiles = data.profiles || {};\r\n      if (!profiles[activeProfile]) profiles[activeProfile] = {};\r\n\r\n      profiles[activeProfile].globalNightMode = nightModeEnabled;\r\n      chrome.storage.sync.set({ profiles });\r\n\r\n      // Save state per site if rememberPerSite is enabled\r\n      if (data.rememberPerSite) {\r\n        const sites = data.nightModeSites || {};\r\n        sites[hostname] = nightModeEnabled;\r\n        chrome.storage.sync.set({ nightModeSites: sites });\r\n      }\r\n      sendResponse({ nightMode: nightModeEnabled });\r\n    });\r\n\r\n    return true; // keep message channel open for async sendResponse\r\n  }\r\n});\r\n\r\n// ΓöÇΓöÇ Key Term Highlighting ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nfunction applyDyslexicFont() {\r\n  const styleId = 'fiscal-fox-dyslexic-font';\r\n  let styleEl = document.getElementById(styleId);\r\n\r\n  if (dyslexicReadingEnabled) {\r\n    if (!styleEl) {\r\n      const fontUrl = chrome.runtime.getURL('OpenDyslexic-Regular.otf');\r\n      styleEl = document.createElement('style');\r\n      styleEl.id = styleId;\r\n      styleEl.textContent = `\r\n        @font-face {\r\n          font-family: 'OpenDyslexic';\r\n          src: url('${fontUrl}') format('opentype');\r\n          font-weight: normal;\r\n          font-style: normal;\r\n        }\r\n        * {\r\n          font-family: 'OpenDyslexic', sans-serif !important;\r\n        }\r\n      `;\r\n      document.head.appendChild(styleEl);\r\n    }\r\n  } else {\r\n    if (styleEl) styleEl.remove();\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\content\\remote-handler.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":10,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":10,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":17,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":65,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":65,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":105,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":105,"endColumn":11}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Fawn Remote Access Handler\r\n// Injected into all pages to manage local safety features during a remote session\r\n\r\nlet isRemoteSessionActive = false;\r\nlet sessionOverlay = null;\r\nlet stopButton = null;\r\nlet lastLocalInputTime = 0;\r\n\r\nfunction initRemoteHandler() {\r\n    chrome.storage.local.get(['remoteSessionState'], (data) => {\r\n        if (data.remoteSessionState === 'HOSTING') {\r\n            enableSafetyFeatures();\r\n        }\r\n    });\r\n\r\n    // Listen for state changes\r\n    chrome.storage.onChanged.addListener((changes, areaName) => {\r\n        if (areaName === 'local' && changes.remoteSessionState) {\r\n            if (changes.remoteSessionState.newValue === 'HOSTING') {\r\n                enableSafetyFeatures();\r\n            } else {\r\n                disableSafetyFeatures();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction enableSafetyFeatures() {\r\n    if (isRemoteSessionActive) return;\r\n    isRemoteSessionActive = true;\r\n\r\n    // 1. Install Yellow Border Overlay\r\n    sessionOverlay = document.createElement('div');\r\n    sessionOverlay.style.position = 'fixed';\r\n    sessionOverlay.style.top = '0';\r\n    sessionOverlay.style.left = '0';\r\n    sessionOverlay.style.width = '100vw';\r\n    sessionOverlay.style.height = '100vh';\r\n    sessionOverlay.style.border = '6px solid #FEF250'; // Bright yellow\r\n    sessionOverlay.style.boxSizing = 'border-box';\r\n    sessionOverlay.style.pointerEvents = 'none'; // Let clicks pass through\r\n    sessionOverlay.style.zIndex = '2147483646'; // Maximum z-index minus 1\r\n    sessionOverlay.style.boxShadow = 'inset 0 0 15px rgba(254, 242, 80, 0.5)';\r\n    document.documentElement.appendChild(sessionOverlay);\r\n\r\n    // 2. Install Emergency Stop Button\r\n    stopButton = document.createElement('button');\r\n    stopButton.style.position = 'fixed';\r\n    stopButton.style.bottom = '20px';\r\n    stopButton.style.right = '20px';\r\n    stopButton.style.width = '60px';\r\n    stopButton.style.height = '60px';\r\n    stopButton.style.borderRadius = '50%';\r\n    stopButton.style.backgroundColor = '#ef4444';\r\n    stopButton.style.color = '#fff';\r\n    stopButton.style.border = '3px solid #fff';\r\n    stopButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.4)';\r\n    stopButton.style.cursor = 'pointer';\r\n    stopButton.style.zIndex = '2147483647'; // Absolute maximum\r\n    stopButton.textContent = 'STOP'; // Fallback if no image\r\n    stopButton.style.fontWeight = 'bold';\r\n    stopButton.title = 'End Remote Access Session instantly';\r\n\r\n    // Try to load a red block icon if available (fallback to styled button otherwise)\r\n    const imgUrl = chrome.runtime.getURL('red-stop-btn.png');\r\n    stopButton.style.backgroundImage = `url('${imgUrl}')`;\r\n    stopButton.style.backgroundSize = 'cover';\r\n    stopButton.style.backgroundPosition = 'center';\r\n\r\n    stopButton.addEventListener('click', () => {\r\n        terminateSession('Emergency Stop Button Clicked');\r\n    });\r\n\r\n    document.documentElement.appendChild(stopButton);\r\n\r\n    // 3. Register Global Emergency Kill Shortcut (Ctrl+Alt+B / Cmd+Option+B)\r\n    document.addEventListener('keydown', handleKillShortcut, true);\r\n\r\n    // 4. Register Local Input Priority Trackers\r\n    document.addEventListener('mousemove', trackLocalInput, true);\r\n    document.addEventListener('mousedown', trackLocalInput, true);\r\n    document.addEventListener('keydown', trackLocalInput, true);\r\n\r\n    console.log('Fawn: Remote Access Safety Features Enabled.');\r\n}\r\n\r\nfunction disableSafetyFeatures() {\r\n    if (!isRemoteSessionActive) return;\r\n    isRemoteSessionActive = false;\r\n\r\n    if (sessionOverlay && sessionOverlay.parentNode) sessionOverlay.parentNode.removeChild(sessionOverlay);\r\n    if (stopButton && stopButton.parentNode) stopButton.parentNode.removeChild(stopButton);\r\n\r\n    document.removeEventListener('keydown', handleKillShortcut, true);\r\n    document.removeEventListener('mousemove', trackLocalInput, true);\r\n    document.removeEventListener('mousedown', trackLocalInput, true);\r\n    document.removeEventListener('keydown', trackLocalInput, true);\r\n\r\n    console.log('Fawn: Remote Access Safety Features Disabled.');\r\n}\r\n\r\nfunction terminateSession(reason) {\r\n    console.warn('Fawn: Terminating remote session. Reason:', reason);\r\n    disableSafetyFeatures();\r\n    chrome.storage.local.remove(['remoteSessionState', 'remoteAccessCode']);\r\n    alert('Remote Access Connection Terminated.');\r\n}\r\n\r\nfunction handleKillShortcut(e) {\r\n    // Check for Ctrl + Alt + B (Windows/Linux) or Cmd + Option + B (Mac)\r\n    if ((e.ctrlKey || e.metaKey) && e.altKey && e.key.toLowerCase() === 'b') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        terminateSession('Keyboard Kill Shortcut Used');\r\n    }\r\n}\r\n\r\nfunction trackLocalInput(e) {\r\n    // If this event was artificially dispatched by a script (e.g. simulated click from remote helper),\r\n    // e.isTrusted is false. True physical inputs from the local user have e.isTrusted = true.\r\n    if (e.isTrusted) {\r\n        lastLocalInputTime = Date.now();\r\n    }\r\n}\r\n\r\n// Exported function for the simulated remote helper script to check if it's allowed to interact\r\nconst isRemoteInputAllowed = function () {\r\n    // Prevent remote actions if physical user interacted within the last 2 seconds (2000ms)\r\n    return (Date.now() - lastLocalInputTime) > 2000;\r\n};\r\nwindow.isRemoteInputAllowed = isRemoteInputAllowed;\r\n\r\n// Start\r\ninitRemoteHandler();\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\content\\summarize-transactions.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":9,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":9,"endColumn":21},{"ruleId":"no-loop-func","severity":1,"message":"Function declared in a loop contains unsafe references to variable(s) 'node'.","line":146,"column":7,"nodeType":"ArrowFunctionExpression","messageId":"unsafeRefs","endLine":148,"endColumn":59},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":730,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":730,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Summarize Transactions ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nlet categoriesCache = null;\r\nlet sidebarOpen = false;\r\n\r\n// ΓöÇΓöÇ Load categories from extension resources ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nasync function loadCategories() {\r\n  if (categoriesCache) return categoriesCache;\r\n  const url = chrome.runtime.getURL('categories.json');\r\n  const resp = await fetch(url);\r\n  categoriesCache = await resp.json();\r\n  return categoriesCache;\r\n}\r\n\r\n// ΓöÇΓöÇ Categorize a single transaction description ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction categorize(description, categories) {\r\n  const desc = description.toLowerCase();\r\n  for (const [name, cat] of Object.entries(categories)) {\r\n    if (name === 'Other') continue;\r\n    for (const keyword of cat.keywords) {\r\n      if (desc.includes(keyword.toLowerCase())) {\r\n        return name;\r\n      }\r\n    }\r\n  }\r\n  return 'Other';\r\n}\r\n\r\n// ΓöÇΓöÇ Parse dollar amount from text ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n// Returns the raw signed value as displayed:\r\n//   positive  = money went out (debit / withdrawal)\r\n//   negative  = money came in  (credit / deposit)\r\n// Callers that already know the column type can override the sign.\r\nfunction parseAmount(text, forceSign) {\r\n  if (!text) return null;\r\n  const t = text.trim();\r\n\r\n  // Credit indicators ΓåÆ money in (negative in our convention)\r\n  const isCreditText = /\\bcr\\b/i.test(t) || /\\bcredit\\b/i.test(t);\r\n  const isDebitText  = /\\bdr\\b/i.test(t) || /\\bdebit\\b/i.test(t);\r\n\r\n  // Strip everything except digits, dot, minus\r\n  const numStr = t.replace(/[$,\\s]/g, '').replace(/[()]/g, '').replace(/[CRDRcrdr]/g, '');\r\n  const numeric = parseFloat(numStr);\r\n  if (isNaN(numeric) || numeric === 0) return null;\r\n\r\n  const abs = Math.abs(numeric);\r\n\r\n  // Explicit override from column type\r\n  if (forceSign === 'debit')  return  abs;   // spending\r\n  if (forceSign === 'credit') return -abs;   // income\r\n\r\n  // CR/DR suffixes\r\n  if (isCreditText) return -abs;\r\n  if (isDebitText)  return  abs;\r\n\r\n  // Negative number on-screen ΓåÆ debit on most Canadian bank sites\r\n  if (numeric < 0) return abs;\r\n\r\n  // Positive with no indicator ΓåÆ treat as credit (money in, balance increases)\r\n  // Canadian bank convention: positive = deposit, negative = withdrawal\r\n  return -abs;\r\n}\r\n\r\n// ΓöÇΓöÇ Date extraction helper ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nconst DATE_PATTERNS = [\r\n  /\\d{4}-\\d{2}-\\d{2}/,                         // YYYY-MM-DD\r\n  /\\d{2}\\/\\d{2}\\/\\d{4}/,                       // DD/MM/YYYY or MM/DD/YYYY\r\n  /\\d{2}-\\d{2}-\\d{4}/,                         // DD-MM-YYYY\r\n  /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\\s+\\d{1,2}(\\s*,\\s*\\d{4})?/i,\r\n  /\\d{1,2}\\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)(\\s*\\d{4})?/i,\r\n];\r\n\r\nfunction looksLikeDate(text) {\r\n  return DATE_PATTERNS.some(p => p.test(text));\r\n}\r\n\r\nfunction extractDateMonth(text) {\r\n  // Return \"Month YYYY\" string for grouping\r\n  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\r\n\r\n  // YYYY-MM-DD\r\n  const iso = text.match(/(\\d{4})-(\\d{2})-\\d{2}/);\r\n  if (iso) {\r\n    const idx = parseInt(iso[2], 10) - 1;\r\n    return months[idx] + ' ' + iso[1];\r\n  }\r\n  // DD/MM/YYYY or MM/DD/YYYY ΓÇö assume MM/DD/YYYY for North American banks\r\n  const slash = text.match(/(\\d{2})\\/(\\d{2})\\/(\\d{4})/);\r\n  if (slash) {\r\n    const idx = parseInt(slash[1], 10) - 1;\r\n    return months[idx] + ' ' + slash[3];\r\n  }\r\n  // \"Jan 15, 2026\" or \"Jan 15\"\r\n  const named = text.match(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\\s+\\d{1,2}(?:\\s*,\\s*(\\d{4}))?/i);\r\n  if (named) {\r\n    const yr = named[2] || new Date().getFullYear();\r\n    return named[1].charAt(0).toUpperCase() + named[1].slice(1).toLowerCase() + ' ' + yr;\r\n  }\r\n  return null;\r\n}\r\n\r\n// ΓöÇΓöÇ Detect column types from a header row ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction getColumnMap(headerRow) {\r\n  const cells = Array.from(headerRow.querySelectorAll('th, td'));\r\n  const headers = cells.map(c => c.textContent.trim().toLowerCase());\r\n  return {\r\n    dateIdx:   headers.findIndex(h => /\\bdate\\b/.test(h)),\r\n    descIdx:   headers.findIndex(h => /description|details|memo|payee|merchant|transactions?/i.test(h)),\r\n    debitIdx:  headers.findIndex(h => /\\b(debit|withdrawal|withdrawals|out|charge)\\b/i.test(h)),\r\n    creditIdx: headers.findIndex(h => /\\b(credit|deposit|deposits)\\b/i.test(h)),\r\n    amountIdx: headers.findIndex(h => /\\bamount\\b/i.test(h)),\r\n  };\r\n}\r\n\r\n// ΓöÇΓöÇ Check if an element lives inside a DEBIT/Withdrawal table context ΓöÇΓöÇ\r\nfunction hasDebitHeaderNearby(el) {\r\n  // Case 0: the row has a td.debit WITH an actual dollar amount (CIBC pattern)\r\n  // A td.debit containing \"Not applicable\" or no $ means this is a credit row\r\n  const row = el.closest('tr');\r\n  if (row) {\r\n    const debitTd = row.querySelector('td[class*=\"debit\"], td[class*=\"withdrawal\"]');\r\n    if (debitTd && /\\$[\\d]/.test(debitTd.textContent)) return true;\r\n  }\r\n\r\n  // Case 1: inside a real <table> ΓÇö check its <th> / <thead> cells\r\n  const table = el.closest('table');\r\n  if (table) {\r\n    return Array.from(table.querySelectorAll('th, thead td, [role=\"columnheader\"]'))\r\n      .some(h => /\\bdebit\\b|\\bwithdrawal\\b/i.test(h.textContent));\r\n  }\r\n\r\n  // Case 2: ARIA table (role=\"table\" / role=\"grid\")\r\n  const ariaTable = el.closest('[role=\"table\"], [role=\"grid\"]');\r\n  if (ariaTable) {\r\n    return Array.from(ariaTable.querySelectorAll('[role=\"columnheader\"]'))\r\n      .some(h => /\\bdebit\\b|\\bwithdrawal\\b/i.test(h.textContent));\r\n  }\r\n\r\n  // Case 3: div-based layout ΓÇö look for a sibling/parent whose short text is \"DEBIT\"\r\n  let node = el.parentElement;\r\n  for (let i = 0; i < 6; i++) {\r\n    if (!node || node === document.body) break;\r\n    const siblings = Array.from(node.parentElement?.children || []);\r\n    const debitSibling = siblings.find(\r\n      s => s !== node &&\r\n           s.textContent.trim().length < 50 &&\r\n           /\\bdebit\\b|\\bwithdrawal\\b/i.test(s.textContent)\r\n    );\r\n    if (debitSibling) return true;\r\n    node = node.parentElement;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// ΓöÇΓöÇ Strategy 3: date-first text-node scan (works for any DOM layout) ΓöÇΓöÇ\r\nfunction extractByDateScan() {\r\n  const transactions = [];\r\n  const seenRows = new Set();\r\n\r\n  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);\r\n  let node;\r\n\r\n  while ((node = walker.nextNode())) {\r\n    const text = node.textContent.trim();\r\n    // Must look like a date and be short (skip large paragraphs that happen to contain a date)\r\n    if (!looksLikeDate(text) || text.length > 35) continue;\r\n\r\n    const el = node.parentElement;\r\n    if (!el) continue;\r\n    // Skip our own sidebar\r\n    if (el.closest('#fiscal-fox-sidebar-host')) continue;\r\n\r\n    // Find the \"row\" ΓÇö prefer <tr> or role=\"row\", fall back to direct parent\r\n    const row = el.closest('tr') ||\r\n                el.closest('[role=\"row\"]') ||\r\n                el.parentElement;\r\n    if (!row || seenRows.has(row) || row === document.body) continue;\r\n    seenRows.add(row);\r\n\r\n    // Skip rows that have class-based debit/credit columns ΓÇö already handled by Strategy 1\r\n    if (row.querySelector && (row.querySelector('td[class*=\"debit\"]') || row.querySelector('td[class*=\"credit\"]'))) continue;\r\n\r\n    const rowText = row.textContent.replace(/\\s+/g, ' ').trim();\r\n\r\n    // Find a dollar amount in this row\r\n    const amountMatches = rowText.match(/\\$[\\d,]+\\.\\d{2}/g);\r\n    if (!amountMatches) continue;\r\n    const amountText = amountMatches[0];\r\n\r\n    const dateText = text;\r\n\r\n    // Determine sign: explicit negative on screen = definitely a debit;\r\n    // DEBIT column header nearby = force debit; otherwise skip (ambiguous)\r\n    const isExplicitNegative = /[-\\u2212]\\s*\\$[\\d,]+/.test(rowText) ||\r\n                               /\\(\\$[\\d,]/.test(rowText);\r\n    const isDebitCtx = hasDebitHeaderNearby(el);\r\n\r\n    let forceSign = null;\r\n    if (isExplicitNegative || isDebitCtx) forceSign = 'debit';\r\n\r\n    const amount = parseAmount(amountText, forceSign);\r\n    // Only keep spending (positive in our convention)\r\n    if (!amount || amount <= 0) continue;\r\n\r\n    // Build description from what's left after removing date + amount\r\n    let description = rowText\r\n      .replace(dateText, '')\r\n      .replace(amountText, '')\r\n      .replace(/\\s+/g, ' ')\r\n      .trim()\r\n      .split('\\n')[0]\r\n      .trim();\r\n    if (description.length > 100) description = description.slice(0, 100);\r\n    if (!description) description = 'Unknown';\r\n\r\n    transactions.push({\r\n      date: dateText,\r\n      month: extractDateMonth(dateText),\r\n      description,\r\n      amount,\r\n    });\r\n  }\r\n\r\n  return transactions;\r\n}\r\n\r\n// ΓöÇΓöÇ Extract transactions from the page DOM ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction extractTransactions() {\r\n  const transactions = [];\r\n\r\n  // Strategy 1: scan <table> elements (header-aware)\r\n  document.querySelectorAll('table').forEach(table => {\r\n    const allRows = Array.from(table.querySelectorAll('tr'));\r\n    if (allRows.length < 2) return;\r\n\r\n    const headerRow = allRows.find(r => r.querySelector('th')) || allRows[0];\r\n    const colMap = getColumnMap(headerRow);\r\n    const hasUsefulHeaders = colMap.dateIdx >= 0 || colMap.debitIdx >= 0 || colMap.amountIdx >= 0;\r\n\r\n    allRows.forEach(row => {\r\n      if (row === headerRow) return;\r\n      const cells = Array.from(row.querySelectorAll('td'));\r\n      if (cells.length < 2) return;\r\n\r\n      let dateText, description, amount;\r\n\r\n      // ΓöÇΓöÇ Class-based detection (e.g. CIBC: td.date, td.debit, td.credit) ΓöÇΓöÇ\r\n      const debitTd  = row.querySelector('td[class*=\"debit\"], td[class*=\"withdrawal\"]');\r\n      const creditTd = row.querySelector('td[class*=\"credit\"], td[class*=\"deposit\"]');\r\n      const dateTd   = row.querySelector('td[class*=\"date\"]');\r\n      const descTd   = row.querySelector('td[class*=\"transaction\"], td[class*=\"description\"], td[class*=\"detail\"], td[class*=\"memo\"]');\r\n\r\n      if (dateTd && (debitTd || creditTd)) {\r\n        // Only process debit rows; skip deposit rows\r\n        if (!debitTd) return;\r\n        const raw = debitTd.textContent.trim().replace(/\\s+/g, ' ');\r\n        // \"Not applicable\", blank, or no dollar sign ΓåÆ this row is a deposit, skip\r\n        if (!raw || /not applicable|n\\/a/i.test(raw) || !/\\$[\\d]/.test(raw)) return;\r\n\r\n        dateText    = dateTd.textContent.trim();\r\n        description = descTd ? descTd.textContent.trim().replace(/\\s+/g, ' ') : null;\r\n        amount      = parseAmount(raw, 'debit');\r\n\r\n        if (!amount || amount <= 0) return;\r\n        if (!looksLikeDate(dateText)) return;\r\n\r\n        if (!description) {\r\n          const usedTds = new Set([dateTd, debitTd, creditTd].filter(Boolean));\r\n          const fallback = cells.find(td => !usedTds.has(td) && td.textContent.trim().length > 1 && !/\\$[\\d]/.test(td.textContent));\r\n          description = fallback ? fallback.textContent.trim().replace(/\\s+/g, ' ') : 'Unknown';\r\n        }\r\n\r\n        transactions.push({ date: dateText, month: extractDateMonth(dateText), description, amount });\r\n        return; // row handled, skip header-guided path below\r\n      }\r\n\r\n      // ΓöÇΓöÇ Header-guided or heuristic detection ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n      const texts = cells.map(c => c.textContent.trim().replace(/\\s+/g, ' '));\r\n\r\n      if (hasUsefulHeaders) {\r\n        dateText    = colMap.dateIdx >= 0 ? texts[colMap.dateIdx] : texts.find(t => looksLikeDate(t));\r\n        description = colMap.descIdx >= 0 ? texts[colMap.descIdx] : null;\r\n\r\n        if (colMap.debitIdx >= 0) {\r\n          const raw = texts[colMap.debitIdx];\r\n          if (!raw || raw === '-' || raw === '') return;\r\n          amount = parseAmount(raw, 'debit');\r\n        } else if (colMap.amountIdx >= 0) {\r\n          amount = parseAmount(texts[colMap.amountIdx]);\r\n        } else {\r\n          const amountText = texts.find(t => /\\$[\\d,]+\\.?\\d*|^-?[\\d,]+\\.\\d{2}$|\\([\\d,]+\\.\\d{2}\\)/.test(t));\r\n          amount = amountText ? parseAmount(amountText) : null;\r\n        }\r\n      } else {\r\n        const dateCell   = texts.find(t => looksLikeDate(t));\r\n        const amountCell = texts.find(t => /\\$[\\d,]+\\.?\\d*|^-?[\\d,]+\\.\\d{2}$|\\([\\d,]+\\.\\d{2}\\)/.test(t));\r\n        if (!dateCell || !amountCell) return;\r\n        dateText = dateCell;\r\n        amount = parseAmount(amountCell);\r\n      }\r\n\r\n      if (!dateText || !looksLikeDate(dateText)) return;\r\n      if (amount === null) return;\r\n\r\n      if (!description) {\r\n        const usedIndices = [colMap.dateIdx, colMap.debitIdx, colMap.creditIdx, colMap.amountIdx].filter(i => i >= 0);\r\n        description = texts.find((t, i) => !usedIndices.includes(i) && t.length > 1 && !looksLikeDate(t) && !/\\$[\\d,]/.test(t)) || 'Unknown';\r\n      }\r\n\r\n      transactions.push({ date: dateText, month: extractDateMonth(dateText), description, amount });\r\n    });\r\n  });\r\n\r\n  // Strategy 2: class-name-based div rows (modern SPA banking sites)\r\n  const TRANSACTION_SELECTORS = [\r\n    '[class*=\"transaction\"]', '[class*=\"Transaction\"]',\r\n    '[class*=\"activity\"]',   '[class*=\"Activity\"]',\r\n    '[class*=\"history\"]',    '[class*=\"History\"]',\r\n    '[aria-label*=\"transaction\"]', '[data-testid*=\"transaction\"]',\r\n  ];\r\n  const seen = new Set();\r\n  TRANSACTION_SELECTORS.forEach(sel => {\r\n    document.querySelectorAll(sel).forEach(el => {\r\n      if (seen.has(el)) return;\r\n      seen.add(el);\r\n\r\n      // Skip elements inside rows with class-based debit/credit columns (handled by Strategy 1)\r\n      const closestRow = el.closest('tr') || el;\r\n      if (closestRow.querySelector('td[class*=\"debit\"]') || closestRow.querySelector('td[class*=\"credit\"]')) return;\r\n\r\n      const text = el.textContent.trim().replace(/\\s+/g, ' ');\r\n      const dateMatch  = DATE_PATTERNS.map(p => text.match(p)).find(Boolean);\r\n      const amountMatch = text.match(/[-\\u2212]\\s*\\$[\\d,]+\\.?\\d*|\\(\\$[\\d,]+\\.?\\d*\\)|\\$[\\d,]+\\.\\d{2}/);\r\n      if (!dateMatch || !amountMatch) return;\r\n\r\n      const dateText   = dateMatch[0];\r\n      const amountText = amountMatch[0];\r\n      const isDebitCtx = hasDebitHeaderNearby(el);\r\n      const forceSign  = isDebitCtx || /[-\\u2212(]/.test(amountText) ? 'debit' : null;\r\n      const amount     = parseAmount(amountText, forceSign);\r\n      if (!amount || amount <= 0) return;\r\n\r\n      const description = text.replace(dateText, '').replace(amountText, '')\r\n        .trim().split(/\\n|\\s{3,}/)[0].trim() || 'Unknown';\r\n\r\n      transactions.push({ date: dateText, month: extractDateMonth(dateText), description, amount });\r\n    });\r\n  });\r\n\r\n  // Strategy 3: date-first text-node scan ΓÇö catches any DOM structure\r\n  // (CIBC and other banks that use div/CSS grid layouts instead of <table>)\r\n  const s3 = extractByDateScan();\r\n  const existingKeys = new Set(\r\n    transactions.map(t => t.description.slice(0, 20) + '|' + Math.round(t.amount * 100))\r\n  );\r\n  s3.forEach(tx => {\r\n    const key = tx.description.slice(0, 20) + '|' + Math.round(tx.amount * 100);\r\n    if (!existingKeys.has(key)) {\r\n      transactions.push(tx);\r\n      existingKeys.add(key);\r\n    }\r\n  });\r\n\r\n  return transactions;\r\n}\r\n\r\n// ΓöÇΓöÇ Group and summarize transactions ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nasync function buildSummary(transactions) {\r\n  const categories = await loadCategories();\r\n\r\n  // Summarize ALL transactions on the page (across all months)\r\n  // Only count spending: positive amount = money left the account (debit/withdrawal)\r\n  // Negative amounts are credits/deposits ΓÇö excluded from the summary\r\n  const debits = transactions.filter(tx => tx.amount > 0);\r\n\r\n  // Build display label from the months present\r\n  const monthSet = new Set(debits.map(tx => tx.month).filter(Boolean));\r\n  const monthList = Array.from(monthSet);\r\n  const targetMonth = monthList.length === 1 ? monthList[0]\r\n    : monthList.length > 1 ? monthList.join(' & ')\r\n    : 'All Transactions';\r\n\r\n  const catMap = {};\r\n  debits.forEach(tx => {\r\n    const catName = categorize(tx.description, categories);\r\n    if (!catMap[catName]) {\r\n      catMap[catName] = {\r\n        icon: categories[catName]?.icon || '≡ƒôª',\r\n        total: 0,\r\n        items: [],\r\n      };\r\n    }\r\n    catMap[catName].total += tx.amount;\r\n    catMap[catName].items.push(tx);\r\n  });\r\n\r\n  return {\r\n    month: targetMonth,\r\n    totalSpent: debits.reduce((s, tx) => s + tx.amount, 0),\r\n    categories: catMap,\r\n    transactionCount: debits.length,\r\n  };\r\n}\r\n\r\n// ΓöÇΓöÇ Format currency ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction fmt(amount) {\r\n  return '$' + amount.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n}\r\n\r\n// ΓöÇΓöÇ Build sidebar HTML (injected into Shadow DOM) ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction buildSidebarHTML(summary) {\r\n  const catEntries = Object.entries(summary.categories)\r\n    .sort((a, b) => b[1].total - a[1].total);\r\n\r\n  const categoryHTML = catEntries.map(([name, cat], idx) => {\r\n    const itemsHTML = cat.items\r\n      .sort((a, b) => b.amount - a.amount)\r\n      .slice(0, 10)\r\n      .map(tx => `\r\n        <div class=\"ff-item\">\r\n          <span class=\"ff-item-desc\">${escapeHTML(tx.description)}</span>\r\n          <span class=\"ff-item-amount\">${fmt(tx.amount)}</span>\r\n        </div>\r\n      `).join('');\r\n\r\n    return `\r\n      <div class=\"ff-category\">\r\n        <div class=\"ff-cat-header\" data-idx=\"${idx}\">\r\n          <span class=\"ff-cat-icon\">${cat.icon}</span>\r\n          <span class=\"ff-cat-name\">${escapeHTML(name)}</span>\r\n          <span class=\"ff-cat-total\">${fmt(cat.total)}</span>\r\n          <span class=\"ff-chevron\">Γû╢</span>\r\n        </div>\r\n        <div class=\"ff-cat-items\" id=\"ff-items-${idx}\" style=\"display:none;\">\r\n          ${itemsHTML}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  const noDataMsg = catEntries.length === 0\r\n    ? '<div class=\"ff-no-data\">No transactions found on this page. Navigate to your transaction history and try again.</div>'\r\n    : '';\r\n\r\n  return `\r\n    <div class=\"ff-sidebar\">\r\n      <div class=\"ff-header\">\r\n        <span class=\"ff-title\">≡ƒªè Fiscal Fox</span>\r\n        <button class=\"ff-close\" id=\"ff-close-btn\">Γ£ò</button>\r\n      </div>\r\n      <div class=\"ff-overview\">\r\n        <div class=\"ff-month\">≡ƒôà ${escapeHTML(summary.month)}</div>\r\n        <div class=\"ff-total-label\">Total Spent</div>\r\n        <div class=\"ff-total-amount\">${fmt(summary.totalSpent)}</div>\r\n        <div class=\"ff-tx-count\">${summary.transactionCount} transaction${summary.transactionCount !== 1 ? 's' : ''}</div>\r\n      </div>\r\n      <div class=\"ff-divider\"></div>\r\n      <div class=\"ff-categories\">\r\n        ${noDataMsg}\r\n        ${categoryHTML}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction escapeHTML(str) {\r\n  return String(str)\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;');\r\n}\r\n\r\n// ΓöÇΓöÇ Sidebar CSS ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nconst SIDEBAR_CSS = `\r\n  * { box-sizing: border-box; margin: 0; padding: 0; }\r\n\r\n  .ff-sidebar {\r\n    width: 340px;\r\n    height: 100vh;\r\n    background: #1a1d23;\r\n    color: #e0e0e0;\r\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n    font-size: 14px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    overflow: hidden;\r\n    box-shadow: -4px 0 24px rgba(0,0,0,0.5);\r\n  }\r\n\r\n  .ff-header {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 14px 16px;\r\n    background: #21242d;\r\n    border-bottom: 1px solid #2d3140;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .ff-title {\r\n    font-size: 15px;\r\n    font-weight: 600;\r\n    color: #61dafb;\r\n    letter-spacing: 0.3px;\r\n  }\r\n\r\n  .ff-close {\r\n    background: none;\r\n    border: none;\r\n    color: #888;\r\n    font-size: 18px;\r\n    cursor: pointer;\r\n    padding: 2px 6px;\r\n    border-radius: 4px;\r\n    line-height: 1;\r\n    transition: color 0.15s, background 0.15s;\r\n  }\r\n\r\n  .ff-close:hover {\r\n    color: #fff;\r\n    background: rgba(255,255,255,0.1);\r\n  }\r\n\r\n  .ff-overview {\r\n    padding: 16px;\r\n    background: #21242d;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .ff-month {\r\n    font-size: 12px;\r\n    color: #888;\r\n    margin-bottom: 6px;\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.5px;\r\n  }\r\n\r\n  .ff-total-label {\r\n    font-size: 11px;\r\n    color: #666;\r\n    margin-bottom: 2px;\r\n  }\r\n\r\n  .ff-total-amount {\r\n    font-size: 28px;\r\n    font-weight: 700;\r\n    color: #61dafb;\r\n    letter-spacing: -0.5px;\r\n  }\r\n\r\n  .ff-tx-count {\r\n    font-size: 12px;\r\n    color: #666;\r\n    margin-top: 4px;\r\n  }\r\n\r\n  .ff-divider {\r\n    height: 1px;\r\n    background: #2d3140;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .ff-categories {\r\n    flex: 1;\r\n    overflow-y: auto;\r\n    padding: 8px 0;\r\n  }\r\n\r\n  .ff-categories::-webkit-scrollbar {\r\n    width: 6px;\r\n  }\r\n\r\n  .ff-categories::-webkit-scrollbar-track {\r\n    background: transparent;\r\n  }\r\n\r\n  .ff-categories::-webkit-scrollbar-thumb {\r\n    background: #3a3f50;\r\n    border-radius: 3px;\r\n  }\r\n\r\n  .ff-category {\r\n    border-bottom: 1px solid #2d3140;\r\n  }\r\n\r\n  .ff-cat-header {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    padding: 12px 16px;\r\n    cursor: pointer;\r\n    transition: background 0.15s;\r\n  }\r\n\r\n  .ff-cat-header:hover {\r\n    background: rgba(255,255,255,0.04);\r\n  }\r\n\r\n  .ff-cat-icon {\r\n    font-size: 18px;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .ff-cat-name {\r\n    flex: 1;\r\n    font-weight: 500;\r\n    color: #d0d0d0;\r\n  }\r\n\r\n  .ff-cat-total {\r\n    font-weight: 600;\r\n    color: #61dafb;\r\n    font-size: 13px;\r\n  }\r\n\r\n  .ff-chevron {\r\n    font-size: 10px;\r\n    color: #555;\r\n    transition: transform 0.2s;\r\n    margin-left: 4px;\r\n  }\r\n\r\n  .ff-chevron.open {\r\n    transform: rotate(90deg);\r\n  }\r\n\r\n  .ff-cat-items {\r\n    background: rgba(0,0,0,0.15);\r\n    padding: 0 16px 8px 16px;\r\n  }\r\n\r\n  .ff-item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 6px 0;\r\n    border-bottom: 1px solid #2d3140;\r\n    gap: 8px;\r\n  }\r\n\r\n  .ff-item:last-child {\r\n    border-bottom: none;\r\n  }\r\n\r\n  .ff-item-desc {\r\n    color: #aaa;\r\n    font-size: 12px;\r\n    flex: 1;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n\r\n  .ff-item-amount {\r\n    color: #e0e0e0;\r\n    font-size: 12px;\r\n    font-weight: 500;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .ff-no-data {\r\n    padding: 24px 16px;\r\n    color: #666;\r\n    font-size: 13px;\r\n    line-height: 1.6;\r\n    text-align: center;\r\n  }\r\n`;\r\n\r\n// ΓöÇΓöÇ Inject sidebar into page ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nasync function injectSidebar() {\r\n  // Remove any existing sidebar\r\n  removeSidebar();\r\n\r\n  const transactions = extractTransactions();\r\n  const summary = await buildSummary(transactions);\r\n\r\n  // Create host element\r\n  const host = document.createElement('div');\r\n  host.id = 'fiscal-fox-sidebar-host';\r\n  host.style.cssText =\r\n    'position:fixed;top:0;right:0;width:340px;height:100vh;z-index:2147483647;' +\r\n    'pointer-events:auto;';\r\n  document.body.appendChild(host);\r\n\r\n  // Attach shadow root\r\n  const shadow = host.attachShadow({ mode: 'open' });\r\n\r\n  // Inject styles\r\n  const styleEl = document.createElement('style');\r\n  styleEl.textContent = SIDEBAR_CSS;\r\n  shadow.appendChild(styleEl);\r\n\r\n  // Inject sidebar HTML\r\n  const wrapper = document.createElement('div');\r\n  wrapper.innerHTML = buildSidebarHTML(summary);\r\n  shadow.appendChild(wrapper);\r\n\r\n  // Wire up close button\r\n  shadow.getElementById('ff-close-btn').addEventListener('click', () => {\r\n    removeSidebar();\r\n    sidebarOpen = false;\r\n  });\r\n\r\n  // Wire up category accordions\r\n  shadow.querySelectorAll('.ff-cat-header').forEach(header => {\r\n    header.addEventListener('click', () => {\r\n      const idx = header.dataset.idx;\r\n      const items = shadow.getElementById('ff-items-' + idx);\r\n      const chevron = header.querySelector('.ff-chevron');\r\n      const isOpen = items.style.display !== 'none';\r\n      items.style.display = isOpen ? 'none' : 'block';\r\n      chevron.classList.toggle('open', !isOpen);\r\n    });\r\n  });\r\n\r\n  sidebarOpen = true;\r\n}\r\n\r\n// ΓöÇΓöÇ Remove sidebar from page ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction removeSidebar() {\r\n  const existing = document.getElementById('fiscal-fox-sidebar-host');\r\n  if (existing) existing.remove();\r\n}\r\n\r\n// ΓöÇΓöÇ Message listener from popup ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nchrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {\r\n  if (msg.action === 'toggleSummarize') {\r\n    if (sidebarOpen) {\r\n      removeSidebar();\r\n      sidebarOpen = false;\r\n      sendResponse({ sidebarOpen: false });\r\n    } else {\r\n      injectSidebar().then(() => {\r\n        sendResponse({ sidebarOpen: true });\r\n      });\r\n      return true; // keep channel open for async\r\n    }\r\n  }\r\n\r\n  if (msg.action === 'getSummarizeState') {\r\n    sendResponse({ sidebarOpen });\r\n  }\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\remote-access.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'viewMenu' is assigned a value but never used.","line":3,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'viewGetHelp' is assigned a value but never used.","line":4,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'viewGiveHelp' is assigned a value but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'isHosting' is assigned a value but never used.","line":17,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'connectionCheckInterval' is assigned a value but never used.","line":18,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":39,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":39,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":48,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":48,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"document.addEventListener('DOMContentLoaded', () => {\r\n    // DOM Elements\r\n    const viewMenu = document.getElementById('view-menu');\r\n    const viewGetHelp = document.getElementById('view-get-help');\r\n    const viewGiveHelp = document.getElementById('view-give-help');\r\n\r\n    const btnGetHelp = document.getElementById('btnGetHelp');\r\n    const btnGiveHelp = document.getElementById('btnGiveHelp');\r\n    const btnCancelGetHelp = document.getElementById('btnCancelGetHelp');\r\n    const btnBackFromGiveHelp = document.getElementById('btnBackFromGiveHelp');\r\n\r\n    const btnConnectHelper = document.getElementById('btnConnectHelper');\r\n    const generatedCodeDisplay = document.getElementById('generatedCode');\r\n    const inputAccessCode = document.getElementById('inputAccessCode');\r\n\r\n    // Logic Variables\r\n    let isHosting = false;\r\n    let connectionCheckInterval = null;\r\n\r\n    // View switchers\r\n    function showView(viewId) {\r\n        document.querySelectorAll('.view-panel').forEach(el => el.classList.remove('active'));\r\n        document.getElementById(viewId).classList.add('active');\r\n    }\r\n\r\n    // --- GET HELP (Host / Spectated) --- //\r\n    btnGetHelp.addEventListener('click', () => {\r\n        showView('view-get-help');\r\n\r\n        // Generate a secure 6 digit random number from crypto\r\n        const randomArray = new Uint32Array(1);\r\n        crypto.getRandomValues(randomArray);\r\n        const code = (randomArray[0] % 900000) + 100000; // 100000 to 999999\r\n\r\n        generatedCodeDisplay.textContent = code;\r\n        isHosting = true;\r\n\r\n        // Simulate starting a hosting session in background\r\n        chrome.storage.local.set({\r\n            remoteSessionState: 'HOSTING',\r\n            remoteAccessCode: code.toString()\r\n        });\r\n\r\n    });\r\n\r\n    btnCancelGetHelp.addEventListener('click', () => {\r\n        isHosting = false;\r\n        chrome.storage.local.remove(['remoteSessionState', 'remoteAccessCode']);\r\n        showView('view-menu');\r\n    });\r\n\r\n    // --- GIVE HELP (Client / Helper) --- //\r\n    btnGiveHelp.addEventListener('click', () => {\r\n        showView('view-give-help');\r\n        inputAccessCode.value = '';\r\n        inputAccessCode.focus();\r\n    });\r\n\r\n    btnBackFromGiveHelp.addEventListener('click', () => {\r\n        showView('view-menu');\r\n    });\r\n\r\n    btnConnectHelper.addEventListener('click', () => {\r\n        const code = inputAccessCode.value.trim();\r\n        if (code.length !== 6) {\r\n            alert('Must be exactly 6 digits.');\r\n            return;\r\n        }\r\n\r\n        // \"Connect\" action simulation\r\n        console.log('Attempting simulated remote connection with code:', code);\r\n\r\n        // In a real app this would negotiate WebRTC over signaling server.\r\n        // For this simulation phase, we will just alert.\r\n        alert('Simulated WebRTC connection sequence initiated for code: ' + code);\r\n    });\r\n\r\n    inputAccessCode.addEventListener('keypress', (e) => {\r\n        if (e.key === 'Enter') btnConnectHelper.click();\r\n    });\r\n\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\settings.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":105,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":105,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":117,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":129,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":129,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":135,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":135,"endColumn":11},{"ruleId":"no-restricted-globals","severity":2,"message":"Unexpected use of 'confirm'.","line":144,"column":25,"nodeType":"Identifier","messageId":"defaultMessage","endLine":144,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":151,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":151,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":160,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":160,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":173,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":173,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":178,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":178,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":185,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":185,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":215,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":215,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":262,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":262,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":268,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":268,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":324,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":324,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":331,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":331,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":348,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":348,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":355,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":355,"endColumn":11}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Profile Management ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nlet activeProfile = 'Mom'; // Default profile\r\nlet profileList = ['Mom', 'Dad', 'Son', 'Daughter'];\r\n\r\nconst profileContainer = document.getElementById('profileContainer');\r\nconst addProfileBtn = document.getElementById('addProfileBtn');\r\n\r\nfunction renderProfiles() {\r\n  profileContainer.innerHTML = '';\r\n  profileList.forEach(profileName => {\r\n    const btn = document.createElement('div');\r\n    btn.className = `profile-btn ${profileName === activeProfile ? 'active' : ''}`;\r\n\r\n    // The clickable text area\r\n    const nameSpan = document.createElement('span');\r\n    nameSpan.textContent = profileName;\r\n    nameSpan.style.flex = '1';\r\n\r\n    // The inline text input (hidden by default)\r\n    const renameInput = document.createElement('input');\r\n    renameInput.type = 'text';\r\n    renameInput.value = profileName;\r\n    renameInput.style.display = 'none';\r\n    renameInput.style.flex = '1';\r\n    renameInput.style.background = 'rgba(0,0,0,0.3)';\r\n    renameInput.style.color = '#fff';\r\n    renameInput.style.border = '1px solid #4CAF50';\r\n    renameInput.style.padding = '4px 8px';\r\n    renameInput.style.borderRadius = '4px';\r\n    renameInput.style.fontSize = '14px';\r\n\r\n    const commitRename = () => {\r\n      const newName = renameInput.value.trim();\r\n      if (!newName || newName === profileName) {\r\n        renameInput.style.display = 'none';\r\n        nameSpan.style.display = 'inline';\r\n        renameInput.value = profileName; // reset\r\n        return;\r\n      }\r\n      if (profileList.includes(newName)) {\r\n        renameInput.style.borderColor = '#ef4444';\r\n        setTimeout(() => { renameInput.style.borderColor = '#4CAF50'; }, 2000);\r\n        return;\r\n      }\r\n      renameProfile(profileName, newName);\r\n    };\r\n\r\n    renameInput.addEventListener('blur', commitRename);\r\n    renameInput.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') renameInput.blur();\r\n    });\r\n\r\n    const editBtn = document.createElement('button');\r\n    editBtn.textContent = 'Γ£Å∩╕Å';\r\n    editBtn.className = 'profile-edit-btn';\r\n    editBtn.style.background = 'none';\r\n    editBtn.style.border = 'none';\r\n    editBtn.style.cursor = 'pointer';\r\n    editBtn.title = 'Rename';\r\n    editBtn.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      nameSpan.style.display = 'none';\r\n      renameInput.style.display = 'inline-block';\r\n      renameInput.focus();\r\n    });\r\n\r\n    btn.appendChild(nameSpan);\r\n    btn.appendChild(renameInput);\r\n    btn.appendChild(editBtn);\r\n\r\n    // Prevent deleting the very last profile\r\n    if (profileList.length > 1) {\r\n      const delBtn = document.createElement('button');\r\n      delBtn.className = 'profile-delete-btn';\r\n      delBtn.title = 'Delete profile';\r\n      delBtn.textContent = 'Γ¥î';\r\n      delBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation(); // prevent triggering the profile switch\r\n        deleteProfile(profileName);\r\n      });\r\n      btn.appendChild(delBtn);\r\n    }\r\n\r\n    btn.addEventListener('click', (e) => {\r\n      // Only switch if they click the button itself, not the inputs/buttons inside\r\n      if (e.target !== renameInput && e.target !== editBtn && !e.target.classList.contains('profile-delete-btn')) {\r\n        switchProfile(profileName);\r\n      }\r\n    });\r\n\r\n    profileContainer.appendChild(btn);\r\n  });\r\n}\r\n\r\nfunction switchProfile(profile) {\r\n  activeProfile = profile;\r\n\r\n  // Re-render UI buttons\r\n  renderProfiles();\r\n\r\n  // Reload settings for new profile\r\n  loadSettingsForProfile();\r\n\r\n  // Save the new active profile to storage\r\n  chrome.storage.sync.set({ activeProfile });\r\n}\r\n\r\nfunction addNewProfile() {\r\n  let count = 1;\r\n  let newName = `New Profile ${count}`;\r\n  while (profileList.includes(newName)) {\r\n    count++;\r\n    newName = `New Profile ${count}`;\r\n  }\r\n\r\n  profileList.push(newName);\r\n  chrome.storage.sync.set({ profileList }, () => {\r\n    switchProfile(newName); // Switch to the newly created profile\r\n  });\r\n}\r\n\r\nfunction renameProfile(oldName, newName) {\r\n  const index = profileList.indexOf(oldName);\r\n  if (index === -1) return;\r\n\r\n  profileList[index] = newName;\r\n  if (activeProfile === oldName) activeProfile = newName;\r\n\r\n  chrome.storage.sync.get(['profiles'], (data) => {\r\n    const profiles = data.profiles || {};\r\n    if (profiles[oldName]) {\r\n      profiles[newName] = profiles[oldName];\r\n      delete profiles[oldName];\r\n    }\r\n    chrome.storage.sync.set({ profileList, profiles, activeProfile }, () => {\r\n      renderProfiles();\r\n    });\r\n  });\r\n}\r\n\r\nasync function deleteProfile(profileNameToDelete) {\r\n  if (profileList.length <= 1) return; // Prevent deleting last\r\n\r\n  const confirmDelete = confirm(`Are you sure you want to delete the profile \"${profileNameToDelete}\"?`);\r\n  if (!confirmDelete) return;\r\n\r\n  // Remove from our list\r\n  profileList = profileList.filter(p => p !== profileNameToDelete);\r\n\r\n  // Storage cleanup\r\n  chrome.storage.sync.get(['profiles'], (data) => {\r\n    const profiles = data.profiles || {};\r\n    delete profiles[profileNameToDelete]; // delete data\r\n\r\n    let nextProfile = activeProfile;\r\n    if (activeProfile === profileNameToDelete) {\r\n      nextProfile = profileList[0]; // switch to first available if active was deleted\r\n    }\r\n\r\n    chrome.storage.sync.set({ profileList, profiles, activeProfile: nextProfile }, () => {\r\n      if (activeProfile !== nextProfile) {\r\n        switchProfile(nextProfile);\r\n      } else {\r\n        renderProfiles(); // just re-render if active didn't change\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\naddProfileBtn.addEventListener('click', addNewProfile);\r\n\r\n// Load initial profiles array (or seed it)\r\nchrome.storage.sync.get(['profileList', 'activeProfile'], (data) => {\r\n  if (data.profileList && data.profileList.length > 0) {\r\n    profileList = data.profileList;\r\n  } else {\r\n    // Seed initial state\r\n    chrome.storage.sync.set({ profileList });\r\n  }\r\n\r\n  if (data.activeProfile && profileList.includes(data.activeProfile)) {\r\n    activeProfile = data.activeProfile;\r\n  } else {\r\n    activeProfile = profileList[0]; // Reset to a valid profile if missing\r\n    chrome.storage.sync.set({ activeProfile });\r\n  }\r\n\r\n  renderProfiles();\r\n});\r\n\r\n\r\n// ΓöÇΓöÇ Settings Elements ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nconst nightModeToggle = document.getElementById('nightModeToggle');\r\nconst rememberPerSiteToggle = document.getElementById('rememberPerSite');\r\nconst showBadgeToggle = document.getElementById('showBadge');\r\n\r\nconst colourBlindToggle = document.getElementById('colourBlindToggle');\r\nconst cbSliderR = document.getElementById('cbSliderR');\r\nconst cbSliderG = document.getElementById('cbSliderG');\r\nconst cbSliderB = document.getElementById('cbSliderB');\r\nconst cbValR = document.getElementById('cbValR');\r\nconst cbValG = document.getElementById('cbValG');\r\nconst cbValB = document.getElementById('cbValB');\r\nconst cbSlidersBlock = document.getElementById('cbSlidersBlock');\r\nconst presetBtns = document.querySelectorAll('.preset-btn[data-preset]');\r\nconst customPresetBtn = document.getElementById('customPresetBtn');\r\n\r\nconst keyTermsToggle = document.getElementById('keyTermsToggle');\r\nconst dyslexicReadingToggle = document.getElementById('dyslexicReadingToggle');\r\nconst ttsToggle = document.getElementById('ttsToggle');\r\n\r\n\r\n// ΓöÇΓöÇ Unified Loading ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction loadSettingsForProfile() {\r\n  chrome.storage.sync.get(['profiles'], (data) => {\r\n    const profiles = data.profiles || {};\r\n    // Populate defaults if current profile doesn't exist\r\n    const pData = profiles[activeProfile] || {\r\n      globalNightMode: false,\r\n      rememberPerSite: false,\r\n      showBadge: true,\r\n      colourBlindEnabled: false,\r\n      colourBlindPreset: 'none',\r\n      colourBlindR: 100,\r\n      colourBlindG: 100,\r\n      colourBlindB: 100,\r\n      keyTermsEnabled: false,\r\n      dyslexicReadingEnabled: false,\r\n      ttsEnabled: false\r\n    };\r\n\r\n    // General toggles\r\n    nightModeToggle.checked = !!pData.globalNightMode;\r\n    rememberPerSiteToggle.checked = !!pData.rememberPerSite;\r\n    showBadgeToggle.checked = pData.showBadge !== false;\r\n\r\n    // Colour blind\r\n    colourBlindToggle.checked = !!pData.colourBlindEnabled;\r\n    const r = pData.colourBlindR ?? 100;\r\n    const g = pData.colourBlindG ?? 100;\r\n    const b = pData.colourBlindB ?? 100;\r\n    const preset = pData.colourBlindPreset || 'none';\r\n\r\n    cbSliderR.value = r; cbValR.textContent = r;\r\n    cbSliderG.value = g; cbValG.textContent = g;\r\n    cbSliderB.value = b; cbValB.textContent = b;\r\n    setActivePreset(preset);\r\n    cbSlidersBlock.classList.toggle('disabled', preset === 'monochromacy');\r\n\r\n    // Accessibility\r\n    keyTermsToggle.checked = !!pData.keyTermsEnabled;\r\n    dyslexicReadingToggle.checked = !!pData.dyslexicReadingEnabled;\r\n    ttsToggle.checked = !!pData.ttsEnabled;\r\n  });\r\n}\r\n\r\n// Initial load\r\nloadSettingsForProfile();\r\n\r\n// ΓöÇΓöÇ Unified Saving ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nfunction saveSetting(key, value) {\r\n  chrome.storage.sync.get(['profiles'], (data) => {\r\n    const profiles = data.profiles || {};\r\n    if (!profiles[activeProfile]) profiles[activeProfile] = {};\r\n    profiles[activeProfile][key] = value;\r\n\r\n    // Also save the active profile globally so content scripts know who's driving\r\n    chrome.storage.sync.set({ profiles, activeProfile });\r\n  });\r\n}\r\n\r\n\r\n// ΓöÇΓöÇ Persist General Toggles ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nnightModeToggle.addEventListener('change', () => saveSetting('globalNightMode', nightModeToggle.checked));\r\nrememberPerSiteToggle.addEventListener('change', () => saveSetting('rememberPerSite', rememberPerSiteToggle.checked));\r\nshowBadgeToggle.addEventListener('change', () => saveSetting('showBadge', showBadgeToggle.checked));\r\n\r\n\r\n// ΓöÇΓöÇ Colour Blind Mode Logic ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst CB_PRESETS = {\r\n  none: { r: 100, g: 100, b: 100 },\r\n  deuteranopia: { r: 130, g: 70, b: 100 },\r\n  protanopia: { r: 70, g: 130, b: 100 },\r\n  tritanopia: { r: 100, g: 115, b: 75 },\r\n  monochromacy: { r: 100, g: 100, b: 100 },\r\n};\r\n\r\nfunction setActivePreset(preset) {\r\n  presetBtns.forEach(btn => {\r\n    btn.classList.toggle('active', btn.dataset.preset === preset);\r\n  });\r\n  customPresetBtn.style.display = preset === 'custom' ? 'inline-block' : 'none';\r\n}\r\n\r\nfunction detectPreset(r, g, b) {\r\n  for (const [name, vals] of Object.entries(CB_PRESETS)) {\r\n    if (vals.r === r && vals.g === g && vals.b === b) return name;\r\n  }\r\n  return 'custom';\r\n}\r\n\r\nfunction applyPresetToSliders(preset) {\r\n  const vals = CB_PRESETS[preset];\r\n  if (!vals) return;\r\n  cbSliderR.value = vals.r; cbValR.textContent = vals.r;\r\n  cbSliderG.value = vals.g; cbValG.textContent = vals.g;\r\n  cbSliderB.value = vals.b; cbValB.textContent = vals.b;\r\n  cbSlidersBlock.classList.toggle('disabled', preset === 'monochromacy');\r\n}\r\n\r\ncolourBlindToggle.addEventListener('change', () => saveSetting('colourBlindEnabled', colourBlindToggle.checked));\r\n\r\n// Preset buttons\r\npresetBtns.forEach(btn => {\r\n  btn.addEventListener('click', () => {\r\n    const preset = btn.dataset.preset;\r\n    if (preset === 'custom') return;\r\n    setActivePreset(preset);\r\n    applyPresetToSliders(preset);\r\n    const vals = CB_PRESETS[preset];\r\n\r\n    // Save batch to avoid multiple async gets\r\n    chrome.storage.sync.get(['profiles'], (data) => {\r\n      const profiles = data.profiles || {};\r\n      if (!profiles[activeProfile]) profiles[activeProfile] = {};\r\n      profiles[activeProfile].colourBlindPreset = preset;\r\n      profiles[activeProfile].colourBlindR = vals.r;\r\n      profiles[activeProfile].colourBlindG = vals.g;\r\n      profiles[activeProfile].colourBlindB = vals.b;\r\n      chrome.storage.sync.set({ profiles, activeProfile });\r\n    });\r\n  });\r\n});\r\n\r\n// RGB sliders\r\nfunction onSliderChange() {\r\n  const r = parseInt(cbSliderR.value, 10);\r\n  const g = parseInt(cbSliderG.value, 10);\r\n  const b = parseInt(cbSliderB.value, 10);\r\n  cbValR.textContent = r;\r\n  cbValG.textContent = g;\r\n  cbValB.textContent = b;\r\n  const detected = detectPreset(r, g, b);\r\n  setActivePreset(detected);\r\n  cbSlidersBlock.classList.toggle('disabled', detected === 'monochromacy');\r\n\r\n  chrome.storage.sync.get(['profiles'], (data) => {\r\n    const profiles = data.profiles || {};\r\n    if (!profiles[activeProfile]) profiles[activeProfile] = {};\r\n    profiles[activeProfile].colourBlindPreset = detected;\r\n    profiles[activeProfile].colourBlindR = r;\r\n    profiles[activeProfile].colourBlindG = g;\r\n    profiles[activeProfile].colourBlindB = b;\r\n    chrome.storage.sync.set({ profiles, activeProfile });\r\n  });\r\n}\r\n\r\ncbSliderR.addEventListener('input', onSliderChange);\r\ncbSliderG.addEventListener('input', onSliderChange);\r\ncbSliderB.addEventListener('input', onSliderChange);\r\n\r\n\r\n// ΓöÇΓöÇ Accessibility Toggles ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\nkeyTermsToggle.addEventListener('change', () => saveSetting('keyTermsEnabled', keyTermsToggle.checked));\r\ndyslexicReadingToggle.addEventListener('change', () => saveSetting('dyslexicReadingEnabled', dyslexicReadingToggle.checked));\r\nttsToggle.addEventListener('change', () => saveSetting('ttsEnabled', ttsToggle.checked));\r\n\r\n\r\n// ΓöÇΓöÇ Keyboard Navigation (Vimium-style) ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\ndocument.addEventListener('keydown', (e) => {\r\n  if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {\r\n    if (e.target.type !== 'checkbox' && e.target.type !== 'range') return;\r\n  }\r\n\r\n  const focusableSelector = 'input[type=\"checkbox\"], select, input[type=\"range\"], .preset-btn, .profile-btn, button';\r\n  const focusableElements = Array.from(document.querySelectorAll(focusableSelector))\r\n    .filter(el => {\r\n      if (el.classList.contains('disabled') || el.closest('.disabled') || el.closest('.sliders-block.disabled')) return false;\r\n      if (el.style.display === 'none' || getComputedStyle(el).display === 'none') return false;\r\n      return true;\r\n    });\r\n\r\n  if (focusableElements.length === 0) return;\r\n\r\n  const currentIndex = focusableElements.indexOf(document.activeElement);\r\n\r\n  if (e.key === 'j') {\r\n    e.preventDefault();\r\n    const nextIndex = (currentIndex + 1) % focusableElements.length;\r\n    focusableElements[nextIndex].focus();\r\n  } else if (e.key === 'k') {\r\n    e.preventDefault();\r\n    const prevIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;\r\n    focusableElements[prevIndex].focus();\r\n  }\r\n});\r\n\r","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\settings\\colourblind.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":46,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":46,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":64,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":64,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":75,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":75,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":95,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":111,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":111,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":116,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":116,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":123,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":123,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":128,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":9}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Colour Blind Mode Settings ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst CB_PRESETS = {\r\n  none: { r: 100, g: 100, b: 100 },\r\n  deuteranopia: { r: 130, g: 70, b: 100 },\r\n  protanopia: { r: 70, g: 130, b: 100 },\r\n  tritanopia: { r: 100, g: 115, b: 75 },\r\n  monochromacy: { r: 100, g: 100, b: 100 },\r\n};\r\n\r\nconst colourBlindToggle = document.getElementById('colourBlindToggle');\r\nconst cbSliderR = document.getElementById('cbSliderR');\r\nconst cbSliderG = document.getElementById('cbSliderG');\r\nconst cbSliderB = document.getElementById('cbSliderB');\r\nconst cbValR = document.getElementById('cbValR');\r\nconst cbValG = document.getElementById('cbValG');\r\nconst cbValB = document.getElementById('cbValB');\r\nconst cbSlidersBlock = document.getElementById('cbSlidersBlock');\r\nconst presetBtns = document.querySelectorAll('.preset-btn[data-preset]');\r\nconst customPresetBtn = document.getElementById('customPresetBtn');\r\n\r\nfunction setActivePreset(preset) {\r\n  presetBtns.forEach(btn => {\r\n    btn.classList.toggle('active', btn.dataset.preset === preset);\r\n  });\r\n  customPresetBtn.style.display = preset === 'custom' ? 'inline-block' : 'none';\r\n}\r\n\r\nfunction detectPreset(r, g, b) {\r\n  for (const [name, vals] of Object.entries(CB_PRESETS)) {\r\n    if (vals.r === r && vals.g === g && vals.b === b) return name;\r\n  }\r\n  return 'custom';\r\n}\r\n\r\nfunction applyPresetToSliders(preset) {\r\n  const vals = CB_PRESETS[preset];\r\n  if (!vals) return;\r\n  cbSliderR.value = vals.r; cbValR.textContent = vals.r;\r\n  cbSliderG.value = vals.g; cbValG.textContent = vals.g;\r\n  cbSliderB.value = vals.b; cbValB.textContent = vals.b;\r\n  cbSlidersBlock.classList.toggle('disabled', preset === 'monochromacy');\r\n}\r\n\r\n// Load saved colour blind settings\r\nchrome.storage.sync.get(\r\n  ['colourBlindEnabled', 'colourBlindPreset', 'colourBlindR', 'colourBlindG', 'colourBlindB'],\r\n  (data) => {\r\n    colourBlindToggle.checked = !!data.colourBlindEnabled;\r\n    const r = data.colourBlindR ?? 100;\r\n    const g = data.colourBlindG ?? 100;\r\n    const b = data.colourBlindB ?? 100;\r\n    const preset = data.colourBlindPreset ?? 'none';\r\n    cbSliderR.value = r; cbValR.textContent = r;\r\n    cbSliderG.value = g; cbValG.textContent = g;\r\n    cbSliderB.value = b; cbValB.textContent = b;\r\n    setActivePreset(preset);\r\n    if (preset === 'monochromacy') cbSlidersBlock.classList.add('disabled');\r\n  }\r\n);\r\n\r\n// Master toggle\r\ncolourBlindToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ colourBlindEnabled: colourBlindToggle.checked });\r\n});\r\n\r\n// Preset buttons\r\npresetBtns.forEach(btn => {\r\n  btn.addEventListener('click', () => {\r\n    const preset = btn.dataset.preset;\r\n    if (preset === 'custom') return;\r\n    setActivePreset(preset);\r\n    applyPresetToSliders(preset);\r\n    const vals = CB_PRESETS[preset];\r\n    chrome.storage.sync.set({\r\n      colourBlindPreset: preset,\r\n      colourBlindR: vals.r,\r\n      colourBlindG: vals.g,\r\n      colourBlindB: vals.b,\r\n    });\r\n  });\r\n});\r\n\r\n// RGB sliders\r\nfunction onSliderChange() {\r\n  const r = parseInt(cbSliderR.value, 10);\r\n  const g = parseInt(cbSliderG.value, 10);\r\n  const b = parseInt(cbSliderB.value, 10);\r\n  cbValR.textContent = r;\r\n  cbValG.textContent = g;\r\n  cbValB.textContent = b;\r\n  const detected = detectPreset(r, g, b);\r\n  setActivePreset(detected);\r\n  cbSlidersBlock.classList.toggle('disabled', detected === 'monochromacy');\r\n  chrome.storage.sync.set({\r\n    colourBlindPreset: detected,\r\n    colourBlindR: r,\r\n    colourBlindG: g,\r\n    colourBlindB: b,\r\n  });\r\n}\r\n\r\ncbSliderR.addEventListener('input', onSliderChange);\r\ncbSliderG.addEventListener('input', onSliderChange);\r\ncbSliderB.addEventListener('input', onSliderChange);\r\n\r\n// ΓöÇΓöÇ Key Term Highlighting ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst keyTermsToggle = document.getElementById('keyTermsToggle');\r\n\r\nchrome.storage.sync.get(['keyTermsEnabled'], (data) => {\r\n  keyTermsToggle.checked = !!data.keyTermsEnabled;\r\n});\r\n\r\nkeyTermsToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ keyTermsEnabled: keyTermsToggle.checked });\r\n});\r\n\r\n// ΓöÇΓöÇ Dyslexic Reading ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst dyslexicReadingToggle = document.getElementById('dyslexicReadingToggle');\r\n\r\nchrome.storage.sync.get(['dyslexicReadingEnabled'], (data) => {\r\n  dyslexicReadingToggle.checked = !!data.dyslexicReadingEnabled;\r\n});\r\n\r\ndyslexicReadingToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ dyslexicReadingEnabled: dyslexicReadingToggle.checked });\r\n});\r\n\r\n// ΓöÇΓöÇ Keyboard Navigation (Vimium-style) ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\ndocument.addEventListener('keydown', (e) => {\r\n  // Only trigger if not typing inside a text input\r\n  if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {\r\n    if (e.target.type !== 'checkbox' && e.target.type !== 'range') {\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Get all focusable elements\r\n  const focusableSelector = '.nav-item, input[type=\"checkbox\"], select, input[type=\"range\"], .preset-btn, button';\r\n  const focusableElements = Array.from(document.querySelectorAll(focusableSelector))\r\n    .filter(el => {\r\n      // Exclude hidden or disabled elements\r\n      if (el.classList.contains('disabled') || el.closest('.disabled') || el.closest('.sliders-block.disabled')) return false;\r\n      if (el.style.display === 'none' || getComputedStyle(el).display === 'none') return false;\r\n      return true;\r\n    });\r\n\r\n  if (focusableElements.length === 0) return;\r\n\r\n  const currentIndex = focusableElements.indexOf(document.activeElement);\r\n\r\n  if (e.key === 'j') {\r\n    e.preventDefault();\r\n    const nextIndex = (currentIndex + 1) % focusableElements.length;\r\n    focusableElements[nextIndex].focus();\r\n  } else if (e.key === 'k') {\r\n    e.preventDefault();\r\n    const prevIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;\r\n    focusableElements[prevIndex].focus();\r\n  } else if ((e.key === 'Enter' || e.key === ' ') && currentIndex !== -1) {\r\n    const el = focusableElements[currentIndex];\r\n    // .nav-item is a div, won't naturally respond to Space/Enter click\r\n    if (el.classList.contains('nav-item')) {\r\n      e.preventDefault();\r\n      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));\r\n      el.classList.add('active');\r\n      // Usually there would be a page change here but this UI is currently static\r\n    }\r\n  }\r\n});\r\n\r\n\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\settings\\key-terms.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":5,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":10,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":10,"endColumn":9}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Key Term Highlighting Settings ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst keyTermsToggle = document.getElementById('keyTermsToggle');\r\n\r\nchrome.storage.sync.get(['keyTermsEnabled'], (data) => {\r\n  keyTermsToggle.checked = !!data.keyTermsEnabled;\r\n});\r\n\r\nkeyTermsToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ keyTermsEnabled: keyTermsToggle.checked });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\settings\\night-mode.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":8,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":8,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":16,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":20,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":24,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":24,"endColumn":9}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ΓöÇΓöÇ Night Mode Settings ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nconst nightModeToggle      = document.getElementById('nightModeToggle');\r\nconst rememberPerSiteToggle = document.getElementById('rememberPerSite');\r\nconst showBadgeToggle      = document.getElementById('showBadge');\r\n\r\n// Load saved settings\r\nchrome.storage.sync.get(['globalNightMode', 'rememberPerSite', 'showBadge'], (data) => {\r\n  nightModeToggle.checked      = !!data.globalNightMode;\r\n  rememberPerSiteToggle.checked = !!data.rememberPerSite;\r\n  showBadgeToggle.checked      = data.showBadge !== false; // default true\r\n});\r\n\r\n// Persist each toggle on change\r\nnightModeToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ globalNightMode: nightModeToggle.checked });\r\n});\r\n\r\nrememberPerSiteToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ rememberPerSite: rememberPerSiteToggle.checked });\r\n});\r\n\r\nshowBadgeToggle.addEventListener('change', () => {\r\n  chrome.storage.sync.set({ showBadge: showBadgeToggle.checked });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\text-to-speech\\controller.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":3,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":14,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":9},{"ruleId":"no-undef","severity":2,"message":"'chrome' is not defined.","line":16,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":21,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":21,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":21,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":21,"endColumn":56},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":30,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":30,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'createMainOverlay' is not defined.","line":35,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":35,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":41,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":41,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":41,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":41,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":49,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":49,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":51,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":51,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'createKeywordOverlay' is not defined.","line":53,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":53,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'removeOverlay' is not defined.","line":65,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":65,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":67,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":67,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":79,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":79,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":79,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":79,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'overlayInput' is not defined.","line":84,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":84,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'matches' is not defined.","line":87,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'findKeywordMatches' is not defined.","line":87,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'currentIndex' is not defined.","line":88,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":88,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'matches' is not defined.","line":90,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":90,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":91,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":91,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":95,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":95,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'matches' is not defined.","line":108,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":108,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'currentIndex' is not defined.","line":108,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":108,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'highlightElement' is not defined.","line":109,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":109,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'removeOverlay' is not defined.","line":111,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":111,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":113,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":113,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":115,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":115,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":115,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":115,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'createMainOverlay' is not defined.","line":117,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'updateOverlayMessage' is not defined.","line":118,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":118,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":120,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":120,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":128,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":128,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'currentIndex' is not defined.","line":133,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":133,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'matches' is not defined.","line":133,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":133,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'currentIndex' is not defined.","line":134,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":134,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":135,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":135,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":135,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":135,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":139,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":139,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":148,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":148,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":148,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":148,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'speak' is not defined.","line":150,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":150,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'createKeywordOverlay' is not defined.","line":152,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":152,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'removeOverlay' is not defined.","line":163,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":163,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'currentState' is not defined.","line":165,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":165,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'State' is not defined.","line":165,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":165,"endColumn":23}],"suppressedMessages":[],"errorCount":52,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Only initialize TTS if the user has enabled it in settings\r\n(function checkTtsSetting() {\r\n  chrome.storage.sync.get(['profiles', 'activeProfile'], (data) => {\r\n    const activeProfile = data.activeProfile || 'Mom';\r\n    const profiles = data.profiles || {};\r\n    const pData = profiles[activeProfile] || {};\r\n\r\n    if (!pData.ttsEnabled) return; // TTS is off by default\r\n\r\n    initTts();\r\n  });\r\n\r\n  // Also listen for setting changes so TTS can activate mid-session\r\n  chrome.storage.onChanged.addListener((changes) => {\r\n    if (changes.profiles || changes.activeProfile) {\r\n      chrome.storage.sync.get(['profiles', 'activeProfile'], (data) => {\r\n        const activeProfile = data.activeProfile || 'Mom';\r\n        const profiles = data.profiles || {};\r\n        const pData = profiles[activeProfile] || {};\r\n\r\n        if (!pData.ttsEnabled && currentState !== State.IDLE) {\r\n          exitExtension();\r\n        }\r\n      });\r\n    }\r\n  });\r\n})();\r\n\r\nfunction initTts() {\r\n  currentState = State.WAITING_FOR_ACTIVATION;\r\n\r\n  // Show overlay immediately, but DON'T auto-speak.\r\n  // Chrome blocks speechSynthesis until a user gesture (keypress/click).\r\n  // The first keypress in activationHandler will unlock audio.\r\n  createMainOverlay();\r\n\r\n  document.addEventListener(\"keydown\", activationHandler);\r\n}\r\n\r\nasync function activationHandler(e) {\r\n  if (currentState !== State.WAITING_FOR_ACTIVATION) return;\r\n\r\n  // Enable ΓÇö user pressed Space (this gesture unlocks audio)\r\n  if (e.code === \"Space\") {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener(\"keydown\", activationHandler);\r\n\r\n    currentState = State.WAITING_FOR_KEYWORD;\r\n\r\n    await speak(\"Type a keyword and press space to confirm.\");\r\n\r\n    createKeywordOverlay();\r\n\r\n    document.addEventListener(\"keydown\", keywordHandler);\r\n    return;\r\n  }\r\n\r\n  // Mute / Do Not Enable\r\n  if (e.key.toLowerCase() === \"m\") {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener(\"keydown\", activationHandler);\r\n\r\n    removeOverlay();\r\n    window.speechSynthesis.cancel();\r\n    currentState = State.IDLE;\r\n    return;\r\n  }\r\n\r\n  // Exit\r\n  if (e.key === \"Escape\") {\r\n    e.preventDefault();\r\n    exitExtension();\r\n  }\r\n}\r\n\r\nasync function keywordHandler(e) {\r\n  if (currentState !== State.WAITING_FOR_KEYWORD) return;\r\n\r\n  if (e.code === \"Space\") {\r\n    e.preventDefault();\r\n\r\n    const keyword = overlayInput.value.trim();\r\n    if (!keyword) return;\r\n\r\n    matches = findKeywordMatches(keyword);\r\n    currentIndex = 0;\r\n\r\n    if (matches.length === 0) {\r\n      await speak(\"No matches found. Type another keyword.\");\r\n      return;\r\n    }\r\n\r\n    currentState = State.READING_SECTION;\r\n    document.removeEventListener(\"keydown\", keywordHandler);\r\n\r\n    await readCurrentMatch();\r\n  }\r\n\r\n  if (e.key === \"Escape\") {\r\n    e.preventDefault();\r\n    exitExtension();\r\n  }\r\n}\r\n\r\nasync function readCurrentMatch() {\r\n  const element = matches[currentIndex];\r\n  highlightElement(element);\r\n\r\n  removeOverlay();\r\n\r\n  await speak(element.innerText);\r\n\r\n  currentState = State.WAITING_FOR_NEXT_ACTION;\r\n\r\n  createMainOverlay();\r\n  updateOverlayMessage(\"Reading complete.\");\r\n\r\n  await speak(\r\n    \"Press space for next result. Press K for new keyword. Press escape to exit.\",\r\n  );\r\n\r\n  document.addEventListener(\"keydown\", navigationHandler);\r\n}\r\n\r\nasync function navigationHandler(e) {\r\n  if (currentState !== State.WAITING_FOR_NEXT_ACTION) return;\r\n\r\n  if (e.code === \"Space\") {\r\n    e.preventDefault();\r\n\r\n    if (currentIndex < matches.length - 1) {\r\n      currentIndex++;\r\n      currentState = State.READING_SECTION;\r\n      document.removeEventListener(\"keydown\", navigationHandler);\r\n      await readCurrentMatch();\r\n    } else {\r\n      await speak(\"No more results.\");\r\n    }\r\n  }\r\n\r\n  if (e.key.toLowerCase() === \"k\") {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener(\"keydown\", navigationHandler);\r\n\r\n    currentState = State.WAITING_FOR_KEYWORD;\r\n\r\n    await speak(\"Type a new keyword and press space.\");\r\n\r\n    createKeywordOverlay();\r\n    document.addEventListener(\"keydown\", keywordHandler);\r\n  }\r\n\r\n  if (e.key === \"Escape\") {\r\n    e.preventDefault();\r\n    exitExtension();\r\n  }\r\n}\r\n\r\nfunction exitExtension() {\r\n  removeOverlay();\r\n  window.speechSynthesis.cancel();\r\n  currentState = State.IDLE;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\text-to-speech\\domReader.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'findKeywordMatches' is defined but never used.","line":32,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'highlightElement' is defined but never used.","line":48,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"function getVisibleTextNodes() {\r\n  const walker = document.createTreeWalker(\r\n    document.body,\r\n    NodeFilter.SHOW_TEXT,\r\n    {\r\n      acceptNode(node) {\r\n        if (!node.parentElement) return NodeFilter.FILTER_REJECT;\r\n\r\n        const style = window.getComputedStyle(node.parentElement);\r\n        if (\r\n          style.display === \"none\" ||\r\n          style.visibility === \"hidden\" ||\r\n          !node.textContent.trim()\r\n        ) {\r\n          return NodeFilter.FILTER_REJECT;\r\n        }\r\n\r\n        return NodeFilter.FILTER_ACCEPT;\r\n      },\r\n    },\r\n  );\r\n\r\n  const nodes = [];\r\n  let node;\r\n  while ((node = walker.nextNode())) {\r\n    nodes.push(node);\r\n  }\r\n\r\n  return nodes;\r\n}\r\n\r\nfunction findKeywordMatches(keyword) {\r\n  const nodes = getVisibleTextNodes();\r\n  const results = [];\r\n\r\n  nodes.forEach((node) => {\r\n    if (node.textContent.toLowerCase().includes(keyword.toLowerCase())) {\r\n      const block = node.parentElement.closest(\"p, li, article, section, div\");\r\n      if (block && !results.includes(block)) {\r\n        results.push(block);\r\n      }\r\n    }\r\n  });\r\n\r\n  return results;\r\n}\r\n\r\nfunction highlightElement(element) {\r\n  document.querySelectorAll(\".fawn-highlight\").forEach((el) => {\r\n    el.classList.remove(\"fawn-highlight\");\r\n  });\r\n\r\n  element.classList.add(\"fawn-highlight\");\r\n  element.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\r\n}\r\n\r\nconst style = document.createElement(\"style\");\r\nstyle.textContent = `\r\n.fawn-highlight {\r\n  background-color: yellow !important;\r\n  outline: 3px solid orange !important;\r\n}\r\n`;\r\ndocument.head.appendChild(style);\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\text-to-speech\\speech.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'speak' is defined but never used.","line":19,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Ensure voices are loaded before first use\r\nlet voicesReady = false;\r\n\r\nfunction ensureVoices() {\r\n  return new Promise((resolve) => {\r\n    const voices = speechSynthesis.getVoices();\r\n    if (voices.length > 0) {\r\n      voicesReady = true;\r\n      resolve();\r\n      return;\r\n    }\r\n    speechSynthesis.addEventListener(\"voiceschanged\", () => {\r\n      voicesReady = true;\r\n      resolve();\r\n    }, { once: true });\r\n  });\r\n}\r\n\r\nfunction speak(text) {\r\n  return new Promise(async (resolve) => {\r\n    if (!voicesReady) await ensureVoices();\r\n\r\n    window.speechSynthesis.cancel();\r\n\r\n    const utterance = new SpeechSynthesisUtterance(text);\r\n    utterance.rate = 1;\r\n    utterance.pitch = 1;\r\n\r\n    utterance.onend = () => resolve();\r\n    utterance.onerror = () => resolve(); // Don't hang if speech fails\r\n\r\n    speechSynthesis.speak(utterance);\r\n  });\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\text-to-speech\\state.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'currentState' is assigned a value but never used.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'matches' is assigned a value but never used.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'currentIndex' is assigned a value but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const State = {\r\n  IDLE: \"IDLE\",\r\n  WAITING_FOR_ACTIVATION: \"WAITING_FOR_ACTIVATION\",\r\n  WAITING_FOR_KEYWORD: \"WAITING_FOR_KEYWORD\",\r\n  READING_SECTION: \"READING_SECTION\",\r\n  WAITING_FOR_NEXT_ACTION: \"WAITING_FOR_NEXT_ACTION\",\r\n};\r\n\r\nlet currentState = State.WAITING_FOR_ACTIVATION;\r\nlet matches = [];\r\nlet currentIndex = 0;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\Overlord\\Downloads\\Hacked2026\\hacked-fiscal-fox\\fiscal-fox\\public\\text-to-speech\\uiOverlay.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'createMainOverlay' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'createKeywordOverlay' is defined but never used.","line":44,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'updateOverlayMessage' is defined but never used.","line":67,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'removeOverlay' is defined but never used.","line":84,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"let overlay = null;\r\nlet overlayInput = null;\r\n\r\nfunction createMainOverlay() {\r\n  overlay = document.createElement(\"div\");\r\n\r\n  overlay.style.position = \"fixed\";\r\n  overlay.style.top = \"0\";\r\n  overlay.style.left = \"0\";\r\n  overlay.style.width = \"100vw\";\r\n  overlay.style.height = \"100vh\";\r\n  overlay.style.backgroundColor = \"rgba(0,0,0,0.95)\";\r\n  overlay.style.color = \"white\";\r\n  overlay.style.zIndex = \"999999\";\r\n  overlay.style.display = \"flex\";\r\n  overlay.style.flexDirection = \"column\";\r\n  overlay.style.alignItems = \"center\";\r\n  overlay.style.justifyContent = \"center\";\r\n  overlay.style.fontSize = \"22px\";\r\n  overlay.style.textAlign = \"center\";\r\n  overlay.style.padding = \"40px\";\r\n\r\n  overlay.setAttribute(\"tabindex\", \"0\");\r\n  overlay.focus();\r\n\r\n  overlay.innerHTML = `\r\n    <div style=\"max-width: 700px;\">\r\n      <p>Fawn is available on this page.</p>\r\n      <p style=\"margin-top: 20px;\">\r\n        Press <strong>SPACE</strong> to enable screen reader.\r\n      </p>\r\n      <p style=\"margin-top: 10px;\">\r\n        Press <strong>M</strong> to continue without enabling.\r\n      </p>\r\n      <p style=\"margin-top: 10px;\">\r\n        Press <strong>ESC</strong> to exit.\r\n      </p>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction createKeywordOverlay() {\r\n  overlay.innerHTML = `\r\n    <div style=\"max-width: 700px;\">\r\n      <p>Type a keyword below.</p>\r\n      <p style=\"font-size:16px; margin-bottom: 20px;\">\r\n        Press SPACE to confirm.\r\n      </p>\r\n    </div>\r\n  `;\r\n\r\n  overlayInput = document.createElement(\"input\");\r\n  overlayInput.type = \"text\";\r\n  overlayInput.style.padding = \"12px\";\r\n  overlayInput.style.fontSize = \"18px\";\r\n  overlayInput.style.width = \"60%\";\r\n  overlayInput.style.marginTop = \"20px\";\r\n  overlayInput.style.borderRadius = \"8px\";\r\n  overlayInput.style.border = \"2px solid orange\";\r\n\r\n  overlay.appendChild(overlayInput);\r\n  overlayInput.focus();\r\n}\r\n\r\nfunction updateOverlayMessage(message) {\r\n  overlay.innerHTML = `\r\n    <div style=\"max-width: 700px;\">\r\n      <p>${message}</p>\r\n      <p style=\"margin-top:20px;\">\r\n        Press SPACE for next result.\r\n      </p>\r\n      <p style=\"margin-top:10px;\">\r\n        Press K for new keyword.\r\n      </p>\r\n      <p style=\"margin-top:10px;\">\r\n        Press ESC to exit.\r\n      </p>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction removeOverlay() {\r\n  if (overlay) {\r\n    overlay.remove();\r\n    overlay = null;\r\n    overlayInput = null;\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]}]
